# Scenario Plot generation

Creating scenario plots is split into the following steps:
1. File structure
2. Generate the scenario data files for each model
3. Run any scenario script for their results (im_fault, ratios and epsilon)

## File Structure
There are a few directories that are not created via these scenario scripts and below described is a tidy way of storing the scenario data results.

At the top you will want some scenarios directory that will store all of your data.

Inside this you will want one scenario_data directory, inside this you will want to create a new directory named of the given model that you are wanting to generate scenario data for, this is done so that you can compare between different models.

In the base scenario directory you will then want to create three directories named *scenario_im_faults*, *scenario_ratios* and *scenario_epsilon*.

In *scenario_ratios* and *scenario_epsilon* you will want to create a *plots* directory. Here is where you will execute the **scenario_ratios.py** script etc and the plots will be generated in there.

For *scenario_im_faults* however you will want to create the sanme directory layout as *scenario_data* except in each model directory you will want to create a plots folder to place the plots in.

The structure in the end will look a bit like this, the rest of the directories are created via the scripts such as *xyz* and *fault_ims* inside each of the directories with *plots* in them.

 * [scenarios](./scenarios)
   * [scenario_data](./scenario_data)
     * [21p6](./scenario_data/21p6)
     * [20p4](./scenario_data/20p4)
     * [emp_20p4](./scenario_data/emp_20p4)
   * [scenario_im_faults](./scenario_im_faults)
        * [21p6](./scenario_im_faults/21p6)
          * [plots](./scenario_im_faults/21p6/plots)
        * [20p4](./scenario_im_faults/20p4)
          * [plots](./scenario_im_faults/20p4/plots)
        * [emp_20p4](./scenario_im_faults/emp_20p4)
          * [plots](./scenario_im_faults/emp_20p4/plots)
   * [scenario_ratios](./scenario_ratios)
     * [plots](./scenario_ratios/plots)
   * [scenario_epsilon](./scenario_epsilon)
     * [plots](./scenario_epsilon/plots)


## Scenario Data
Data for scenarios is generated by running the **scenario_data.py** script.

This will grab all the realisations for each of the given faults for a particular model directory
you specify and create an im csv file with im and sigma values.

The **scenario_data.py** takes the following options
```shell script
usage: scenario_data.py
                      summarise_im_ffp im_csv_dir faults ims output_dir

positional arguments:
  summarise_im_ffp      Full file path to the summarise_all_rels_im script
  im_csv_dir            Full file path to the IM csv directory for the given model
  faults                Faults to extract from the IM CSV's
  ims                   Ims to extract from the IM CSV's
  output_dir            Output directory for the scenario fault files
 
```

#### Example:
```shell script
python scenario_data.py -summarise_im_ffp ../IM_calculation/scripts/summarise_all_rels_im.py -im_csv_dir /isilon/CS_IMs/v21p6_im -faults Port2GreyL HopeConwayOS -ims PGV PGA pSA_0.1 pSA_1.0 pSA_5.0 -output_dir ../scenarios/scenarios_data/21p6
```

The output files will have the columns: *station*, *component*, *ims*

There will be one file per fault for the given model that you are extracting from.

## Scenario Im Faults
Plotting is done using the **scenario_im_fault.py** script.

This should be run in the *scenario_im_faults/MODEL/plots* directory for a single model, otherwise you can run this script inside *scenario_im_faults* and all of the plots for every model will be generated in there.

The script has the following options:
```shell script
usage: scenario_im_fault.py [--model]
                      config_ffp visualization_ffp scenario_data_ffp output_dir

positional arguments:
  config_ffp            Full file path to the scenario_im_fault_config.yaml
  visualization_ffp     Full file path to the visualization repo
  scenario_data_ffp     Full file path to the scenario data directory
  output_dir            Output directory for the scenario im fault files

optional arguments:
  -model                Only run the im faults for this given model
```

Where the config has the following format:
```yaml
faults:
  - "HopeConwayOS"
  - "Wairau"
  - "AlpineK2T"
  - "Port2GreyL"
ims:
  - "PGV"
  - "PGV_sigma"
  - "PGA"
  - "PGA_sigma"
  - "pSA_0.1"
  - "pSA_0.1_sigma"
  - "pSA_1.0"
  - "pSA_1.0_sigma"
  - "pSA_5.0"
  - "pSA_5.0_sigma"
max_ranges:
    PGV: "80"
    PGV_sigma: "0.8"
    PGA: "0.8"
    PGA_sigma: "0.8"
    pSA_0.1: "1.5"
    pSA_0.1_sigma: "0.8"
    pSA_1.0: "0.8"
    pSA_1.0_sigma: "0.8"
    pSA_5.0: "0.2"
    pSA_5.0_sigma: "0.8"
srfs:
    HopeConwayOS: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/HopeConwayOS/Srf/HopeConwayOS_REL01.srf"
    Wairau: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Wairau/Srf/Wairau_REL01.srf"
    AlpineK2T: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/AlpineK2T/Srf/AlpineK2T_REL01.srf"
    Port2GreyL: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Port2GreyL/Srf/Port2GreyL_REL01.srf"
station_file: "/isilon/seistech/sites/20p3/non_uniform_whole_nz_with_real_stations-hh400_v20p3_land.ll"
```

#### Example
```shell script
python ../scenario_im_faults.py -config_ffp ../visualization/cybershake/scenario_ratios_config.yaml -visualization_ffp ../visualization -scenario_data_ffp ../scenarios/scenarios_data -output_dir ../scenarios/scenario_im_faults --model 21p1_21p6
```

## Scenario Ratios
Plotting is done using the **scenario_ratios.py** script.

This should be run in the *scenario_ratios/plots* directory.

The script has the following options:
```shell script
usage: scenario_ratios.py
                      config_ffp visualization_ffp scenario_data_ffp output_dir

positional arguments:
  config_ffp            Full file path to the scenario_ratios_config.yaml
  visualization_ffp     Full file path to the visualization repo
  scenario_data_ffp     Full file path to the scenario data directory
  output_dir            Output directory for the scenario ratio files
```

Where the config has the following format:
```yaml
faults:
  - "HopeConwayOS"
  - "Wairau"
  - "AlpineK2T"
  - "Port2GreyL"
ims:
  - "PGV"
  - "PGV_sigma"
  - "PGA"
  - "PGA_sigma"
  - "pSA_0.1"
  - "pSA_0.1_sigma"
  - "pSA_1.0"
  - "pSA_1.0_sigma"
  - "pSA_5.0"
  - "pSA_5.0_sigma"
max_ranges:
    PGV:
      - "-1"
      - "1"
    PGV_sigma:
      - "-2"
      - "2"
    PGA:
      - "-2"
      - "2"
    PGA_sigma:
      - "-2"
      - "2"
    pSA_0.1:
      - "-1"
      - "1"
    pSA_0.1_sigma:
      - "-2"
      - "2"
    pSA_1.0:
      - "-1.5"
      - "1.5"
    pSA_1.0_sigma:
      - "-2"
      - "2"
    pSA_5.0:
      - "-3"
      - "3"
    pSA_5.0_sigma:
      - "-2"
      - "2"
srfs:
    HopeConwayOS: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/HopeConwayOS/Srf/HopeConwayOS_REL01.srf"
    Wairau: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Wairau/Srf/Wairau_REL01.srf"
    AlpineK2T: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/AlpineK2T/Srf/AlpineK2T_REL01.srf"
    Port2GreyL: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Port2GreyL/Srf/Port2GreyL_REL01.srf"
station_file: "/isilon/seistech/sites/20p3/non_uniform_whole_nz_with_real_stations-hh400_v20p3_land.ll"
```
For the max ranges since this is a ratio plot the first value is the min and the second is the max

#### Example
```shell script
python ../scenario_im_faults.py -config_ffp ../visualization/cybershake/scenario_ratios_config.yaml -visualization_ffp ../visualization -scenario_data_ffp ../scenarios/scenarios_data -output_dir ../scenarios/scenario_im_faults
```

## Scenario Epsilon
Plotting is done using the **scenario_epsilon.py** script.

This should be run in the *scenario_epsilon/plots* directory.

The script has the following options:
```shell script
usage: scenario_epsilon.py
                      config_ffp visualization_ffp scenario_data_ffp output_dir

positional arguments:
  config_ffp            Full file path to the scenario_epsilon_config.yaml
  visualization_ffp     Full file path to the visualization repo
  scenario_data_ffp     Full file path to the scenario data directory
  output_dir            Output directory for the scenario epsilon files
```

Where the config has the following format:
```yaml
faults:
  - "HopeConwayOS"
  - "Wairau"
  - "AlpineK2T"
  - "Port2GreyL"
ims:
  - "PGV_epsilon"
  - "PGA_epsilon"
  - "pSA_0.1_epsilon"
  - "pSA_1.0_epsilon"
  - "pSA_5.0_epsilon"
max_ranges:
    PGV_epsilon:
      - "-0.6"
      - "0.6"
    PGA_epsilon:
      - "-60"
      - "60"
    pSA_0.1_epsilon:
      - "-60"
      - "60"
    pSA_1.0_epsilon:
      - "-60"
      - "60"
    pSA_5.0_epsilon:
      - "-60"
      - "60"
srfs:
    HopeConwayOS: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/HopeConwayOS/Srf/HopeConwayOS_REL01.srf"
    Wairau: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Wairau/Srf/Wairau_REL01.srf"
    AlpineK2T: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/AlpineK2T/Srf/AlpineK2T_REL01.srf"
    Port2GreyL: "/isilon/cybershake/v20p4/Sources/scale_wlg_nobackup/filesets/nobackup/nesi00213/RunFolder/jpa198/cybershake_sources/Data/Sources/Port2GreyL/Srf/Port2GreyL_REL01.srf"
station_file: "/isilon/seistech/sites/20p3/non_uniform_whole_nz_with_real_stations-hh400_v20p3_land.ll"
```
For the max ranges since this is a ratio plot the first value is the min and the second is the max

#### Example
```shell script
python ../scenario_epsilon.py -config_ffp ../visualization/cybershake/scenario_ratios_config.yaml -visualization_ffp ../visualization -scenario_data_ffp ../scenarios/scenarios_data -output_dir ../scenarios/scenario_im_faults
```